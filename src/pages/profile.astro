---
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { Avatar } from '@/components/ui/avatar'
import GrommetIconsGithub from '~icons/grommet-icons/github'
import GrommetIconsLinkedin from '~icons/grommet-icons/linkedin'
import GrommetIconsMail from '~icons/grommet-icons/mail'
import { getRepos } from '../lib/functions/getRepos'
import RepoAccordion from '@/components/RepoAccordion'
import GithubStats from 'astro-github-stats'

let repos: any[] = []
try {
  repos = await getRepos()
} catch (error) {
  console.error('Error fetching repos:', error)
}
---

<BaseLayout title="Profile | Baladithya B" description="Baladithya Balamurugan's developer profile and GitHub activity">
  <section class="container mx-auto max-w-4xl px-4 py-8">
    <!-- Profile Header -->
    <Card className="mb-8">
      <CardContent className="p-6">
        <div class="flex flex-col items-center gap-6 md:flex-row md:items-start">
          <Avatar className="h-24 w-24 ring-2 ring-primary/20">
            <img
              src="https://github.com/baladithyab.png"
              alt="Baladithya Balamurugan"
              class="rounded-full"
              loading="lazy"
            />
          </Avatar>
          <div class="flex-1 text-center md:text-left">
            <h1 class="text-2xl font-bold">Baladithya Balamurugan</h1>
            <p class="text-muted-foreground">@baladithyab</p>
            <p class="mt-2 text-sm leading-relaxed text-muted-foreground">
              Solutions Architect at AWS. Building scalable ML systems and cloud infrastructure.
              Passionate about open source and creating innovative solutions.
            </p>
            <div class="mt-4 flex flex-wrap justify-center gap-3 md:justify-start">
              <a
                href="mailto:bbaladithya@gmail.com"
                class="inline-flex items-center gap-2 rounded-md bg-secondary px-3 py-2 text-sm font-medium text-secondary-foreground hover:bg-secondary/80"
              >
                <GrommetIconsMail class="h-4 w-4" />
                Email
              </a>
              <a
                href="https://github.com/baladithyab"
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 rounded-md bg-secondary px-3 py-2 text-sm font-medium text-secondary-foreground hover:bg-secondary/80"
              >
                <GrommetIconsGithub class="h-4 w-4" />
                GitHub
              </a>
              <a
                href="https://linkedin.com/in/baladithyabalamurugan"
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 rounded-md bg-secondary px-3 py-2 text-sm font-medium text-secondary-foreground hover:bg-secondary/80"
              >
                <GrommetIconsLinkedin class="h-4 w-4" />
                LinkedIn
              </a>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>

    <!-- GitHub Stats Section (Astro component - renders at build time) -->
    <div class="mb-8">
      <h2 class="mb-4 text-xl font-semibold">GitHub Stats</h2>
      <div class="grid gap-6 md:grid-cols-2">
        <Card className="overflow-hidden">
          <CardHeader className="pb-2">
            <CardTitle className="text-lg">Account Stats</CardTitle>
          </CardHeader>
          <CardContent>
            <GithubStats username="baladithyab" showIcons={true} />
          </CardContent>
        </Card>
        <Card className="overflow-hidden">
          <CardHeader className="pb-2">
            <CardTitle className="text-lg">Top Languages</CardTitle>
          </CardHeader>
          <CardContent>
            <GithubStats username="baladithyab" topLanguages={true} />
          </CardContent>
        </Card>
      </div>
    </div>

    <!-- Public Repositories Section (React component - hydrates on client) -->
    <div>
      <h2 class="mb-4 text-xl font-semibold">Public Repositories</h2>
      <Card>
        <CardContent className="p-4">
          {repos.length > 0 ? (
            <RepoAccordion client:load repos={repos} />
          ) : (
            <p class="text-muted-foreground">Unable to load repositories. Please try again later.</p>
          )}
        </CardContent>
      </Card>
    </div>
  </section>
</BaseLayout>
